<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('1d');
    const spawnBox = document.getElementById('spawnBox');

    // Set canvas size
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Physics constants
    const gravity = 0.5;
    const friction = 0.98;
    const bounce = 0.7;

    // Balls array
    let balls = [];

    // Ball class
    class Ball {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.vx = (Math.random() - 0.5) * 4;
            this.vy = (Math.random() - 0.5) * 4;
            this.radius = Math.random() * 8 + 6;
            this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
            this.mass = this.radius;
        }

        update() {
            // Apply gravity
            this.vy += gravity;

            // Apply friction
            this.vx *= friction;
            this.vy *= friction;

            // Update position
            this.x += this.vx;
            this.y += this.vy;

            // Bounce off walls
            if (this.x - this.radius < 0) {
                this.x = this.radius;
                this.vx *= -bounce;
            }
            if (this.x + this.radius > canvas.width) {
                this.x = canvas.width - this.radius;
                this.vx *= -bounce;
            }
            if (this.y - this.radius < 0) {
                this.y = this.radius;
                this.vy *= -bounce;
            }
            if (this.y + this.radius > canvas.height) {
                this.y = canvas.height - this.radius;
                this.vy *= -bounce;
            }
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();

            // Add shine effect
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        isMouseOver(mx, my) {
            const dist = Math.sqrt((this.x - mx) ** 2 + (this.y - my) ** 2);
            return dist < this.radius;
        }
    }

    // Spawn box click handler
    spawnBox.addEventListener('click', () => {
        const rect = spawnBox.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        for (let i = 0; i < 3; i++) {
            balls.push(new Ball(x, y));
        }
    });

    // Mouse tracking for dragging and throwing
    let isDragging = false;
    let selectedBall = null; // Reference to the selected ball
    let dragStart = { x: 0, y: 0 };
    let dragEnd = { x: 0, y: 0 };

    canvas.addEventListener('mousedown', (e) => {
        const mouseX = e.clientX;
        const mouseY = e.clientY;

        // Check if the mouse is over any ball
        for (let ball of balls) {
            if (ball.isMouseOver(mouseX, mouseY)) {
                isDragging = true;
                selectedBall = ball; // Set the selected ball
                dragStart = { x: mouseX, y: mouseY };
                dragEnd = { x: mouseX, y: mouseY };
                break;
            }
        }
    });

    canvas.addEventListener('mousemove', (e) => {
        if (isDragging) {
            dragEnd = { x: e.clientX, y: e.clientY };
            if (selectedBall) {
                // Update ball position to follow the mouse
                selectedBall.x = dragEnd.x;
                selectedBall.y = dragEnd.y;
            }
        }
    });

    canvas.addEventListener('mouseup', () => {
        if (isDragging && selectedBall) {
            // Assign velocity based on drag distance
            selectedBall.vx = (dragEnd.x - dragStart.x) * 0.1;
            selectedBall.vy = (dragEnd.y - dragStart.y) * 0.1;
        }
        isDragging = false;
        selectedBall = null; // Reset the selected ball
    });

    // Animation loop
    function animate() {
        // Clear canvas
        ctx.fillStyle = 'rgba(102, 126, 234, 0.1)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Update and draw balls
        for (let ball of balls) {
            ball.update();
            ball.draw();
        }

        requestAnimationFrame(animate);
    }

    animate();
</script>
